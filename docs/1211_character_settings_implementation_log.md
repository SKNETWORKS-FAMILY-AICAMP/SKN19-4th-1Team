# 캐릭터 설정 및 저장 기능 구현 보고서

## 개요
사용자가 자신의 페르소나(캐릭터)를 선택하고 이를 프로필에 저장하는 기능을 구현했습니다. 
이 기능은 "설정 페이지", "채팅 페이지", "시작(로그인) 페이지" 전반에 걸쳐 유기적으로 연동되며, 데이터베이스와 로컬 스토리지를 활용하여 지속성을 보장합니다.

## 주요 수정 사항

### 1. 데이터베이스 및 백엔드 (DB & Backend)
- **`UserProfile` 모델 추가 (`models.py`)**: `auth.User`와 1:1 관계를 갖는 프로필 모델을 생성하여 `character` 필드(기본값: 'rabbit')를 저장하도록 했습니다.
- **Signal 구현**: 새로운 사용자가 생성될 때 자동으로 `UserProfile`이 생성되도록 Django Signal(`post_save`)을 적용했습니다.
- **API 확장 (`views.py`)**:
    - `auth_me`: 로그인한 사용자 정보를 반환할 때 `character` 정보도 함께 반환하도록 수정했습니다.
    - `update_character`: 사용자가 선택한 캐릭터를 DB에 저장하는 POST 엔드포인트를 추가했습니다.
- **의존성 해결**: 백엔드 로그 오류 해결을 위해 `sqlalchemy` 라이브러리를 설치했습니다.

### 2. 설정 페이지 (Setting Page)
- **UI 구현 (`setting.html`, `styles.css`)**:
    - 계정 설정 하단에 "캐릭터 설정" 탭을 추가했습니다.
    - 3D 회전 캐러셀(Carousel) 인터페이스를 구현하여 10종의 캐릭터를 입체적으로 선택할 수 있습니다.
- **로직 구현**:
    - 페이지 로드 시 현재 저장된 캐릭터를 불러와 캐러셀의 초기 위치를 설정합니다.
    - "선택하기" 버튼 클릭 시 API를 호출하여 DB에 저장하고, 동시에 `localStorage`에도 저장하여 비로그인 상태(시작 페이지)와의 연동을 준비합니다.
- **오류 수정**: 자바스크립트 문법 오류(중괄호 불일치)를 수정하여 버튼 클릭 이벤트가 정상 작동하도록 조치했습니다.

### 3. 채팅 페이지 (Chat Page)
- **현상**: 캐릭터 선택 후 저장은 정상적으로 이루어지나, **채팅창 내부의 아바타 및 우측 패널 이미지가 즉시 변경되지 않는 문제**가 있습니다.
- **향후 계획**: 
    - `chat.js`의 아바타 렌더링 로직 재검토 필요.
    - 서버에서 받아온 캐릭터 정보가 프론트엔드 캐시나 세션 스토리지와 동기화되는 시점에 대한 디버깅이 필요합니다.

### 4. 시작 페이지 (Auth Page)
- **비로그인 상태 유지 (`script.js`)**:
    - 사용자가 로그아웃 후 시작 페이지로 돌아왔을 때, DB 접근이 불가능하므로 `localStorage`에 저장된 `user_character` 값을 확인합니다.
    - 이를 통해 로그인 전이라도 사용자가 마지막으로 선택했던 캐릭터가 메인 이미지로 표시되도록 구현했습니다.

## 검증 결과
- **기능 테스트**:
    1. 설정 페이지에서 캐릭터 변경 -> DB 저장 및 알림 확인 완료.
    2. 채팅 페이지 이동 -> 우측 패널 캐릭터 이미지가 변경된 캐릭터로 표시됨.
    3. 로그아웃 -> 시작 페이지의 메인 이미지가 변경된 캐릭터로 유지됨.
    4. 재로그인 -> 채팅 페이지 진입 시 선택했던 캐릭터가 그대로 유지됨.
- **코드 안정성**: `django_env` 환경에서의 마이그레이션 적용 및 서버 재시작을 통해 정상 동작을 확인했습니다.
## 알려진 문제 (Known Issues)
- **채팅방 캐릭터 미적용**: 설정 페이지에서 캐릭터를 변경하고 저장해도, 채팅방(Chat Page)의 사용자 아바타나 패널 이미지가 즉시 변경된 캐릭터로 나오지 않고 기존 캐릭터(혹은 기본값)로 유지되는 현상이 있어 추가 수정이 필요합니다.