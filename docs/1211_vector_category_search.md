# 벡터 기반 학과 대분류 의미 검색 (Vector-Based Major Category Search)
- **작성일**: 2025-12-11
- **작성자**: Antigravity (Assistant)
- **관련 이슈**: 한양대학교(본교) 등 특정 표준 학과명 분류로 인한 검색 누락 문제 해결

## 1. 배경 및 문제점
### 1.1. 한양대학교 본교/분교 검색 누락 문제
- **상황**: 사용자가 "컴퓨터공학과"를 검색했을 때, 한양대학교 **ERICA캠퍼스**(컴퓨터학부)는 검색되었으나, **본교**(컴퓨터소프트웨어학부)는 검색되지 않음.
- **원인**:
  - Unigo 데이터베이스(`major_detail.json`) 상에서 한양대 본교의 `컴퓨터소프트웨어학부`는 **"소프트웨어공학과"**라는 표준 학과명(대분류)으로 분류되어 있었음.
  - 기존의 SQL `LIKE %컴퓨터%` 검색 로직으로는 **"소프트웨어"**라는 단어가 포함된 대분류를 찾을 수 없었음.
- **기존 해결 시도**:
  - `tools.py`에 하드코딩된 유의어 사전(`synonyms = {"컴퓨터": ["소프트웨어"]}`)을 추가하여 해결했으나, 이는 확장성이 떨어지고 모든 케이스를 커버하기 어려움.

## 2. 해결 방안: 벡터 의미 검색 (Vector Semantic Search) 도입
하드코딩 대신, **벡터 데이터베이스(Pinecone)**의 의미 검색 기능을 활용하여 검색어와 유사한 표준 학과명을 자동으로 확장하는 방식을 구현했습니다.

### 2.1. 아키텍처 변경
1.  **Index 대상**: DB에 존재하는 약 300여 개의 **고유 표준 학과명(Major Name)**.
2.  **Vector Store**: Pinecone의 `major_categories` 네임스페이스 사용.
3.  **검색 로직 (`get_universities_by_department`)**:
    1.  사용자 검색어(예: "컴퓨터")를 Vector DB에 쿼리.
    2.  유사도 상위 20개(`k=20`)의 표준 학과명을 추출 (예: "소프트웨어공학과", "인공지능학과", "정보통신공학과" 등).
    3.  기존 SQL `LIKE` 검색 결과와 Vector 검색 결과를 **병합(Union)**하여 반환.

### 2.2. 구현 상세
- **Ingestion Script**: `backend/scripts/ingest_major_categories.py`
    - DB에서 `DISTINCT major_name`을 추출하여 임베딩 후 Pinecone에 업로드.
- **Tool Logic**: `backend/rag/tools.py`
    - `get_major_category_vectorstore()`를 통해 벡터 스토어 로드.
    - `similarity_search` 수행 후, 결과로 나온 학과명들을 `IN (...)` 쿼리로 DB 조회.

## 3. 검증 결과
- **테스트 케이스**: "컴퓨터공학과" 검색
- **결과**:
    - "컴퓨터" 키워드가 없는 **"소프트웨어공학과"** 분류의 **한양대학교 컴퓨터소프트웨어학부**가 정상적으로 검색 결과에 포함됨.
    - 그 외 "해킹보안학과(정보통신공학과)", "나노광전자학과(광학공학과)" 등 의미적으로 연관된 다양한 학과들이 함께 검색됨.
- **효과**: 사용자가 정확한 학과명을 모르거나("컴퓨터" vs "소프트웨어"), 대학별로 분류가 달라도 유연하게 검색 가능.

## 4. 실행 방법 (유지보수)
데이터베이스의 학과 분류 체계가 변경되거나 새로운 학과가 대거 추가된 경우, 아래 스크립트를 실행하여 벡터 인덱스를 갱신해야 합니다.

```bash
# 가상환경 활성화
conda activate langchain_env

# 대분류 벡터 인덱싱 실행
python backend/scripts/ingest_major_categories.py
```
